<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>QROC Clinique Firebase</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  background: #f4f4f4;
}

.dark {
  background: #121212;
  color: white;
}

.container {
  max-width: 800px;
  margin: auto;
  background: white;
  padding: 20px;
  border-radius: 8px;
}

.dark .container {
  background: #1e1e1e;
}

button {
  padding: 12px;
  margin: 6px;
  cursor: pointer;
}

.cas-btn {
  width: 100%;
  font-size: 16px;
}

textarea {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
}

.answer {
  display: none;
  padding: 10px;
  margin-top: 10px;
  background: #e8ffe8;
  color: black;
}

.dark .answer {
  background: #2b2b2b;
  color: white;
}

.stats-list {
  list-style-type: none;
  padding: 0;
}
</style>
</head>

<body>

<button onclick="toggleDark()">üåô Mode nuit</button>

<div id="home" class="container">
  <h2>QROC Clinique</h2>
  <p id="welcomeText"></p>

  <p>Choisissez un cas clinique :</p>
  <button class="cas-btn" onclick="startCas('cas1')">CAS 1 ‚Äì M√©decine l√©gale</button>
  <button class="cas-btn" onclick="startCas('cas2')">CAS 2 ‚Äì Cardiologie</button>
  <button class="cas-btn" onclick="startCas('cas3')">CAS 3 ‚Äì Pneumologie</button>
  <button class="cas-btn" onclick="startCas('cas4')">CAS 4 ‚Äì Endocrinologie</button>
  <button class="cas-btn" onclick="startCas('cas5')">CAS 5 ‚Äì Gyn√©cologie</button>

  <h3>üìä R√©sultats enregistr√©s</h3>
  <ul id="stats" class="stats-list"></ul>
</div>

<div id="quiz" class="container" style="display:none">
  <h2 id="casTitle"></h2>
  <h3 id="question"></h3>

  <textarea id="userAnswer" placeholder="√âcris ta r√©ponse ici..."></textarea>

  <div>
    <button onclick="showAnswer()">Afficher la correction</button>
    <button onclick="next(true)">‚úî Correct</button>
    <button onclick="next(false)">‚úò Faux</button>
  </div>

  <div id="answer" class="answer"></div>
  <p>Score : <span id="score">0</span></p>

  <button onclick="backHome()">‚¨Ö Retour aux CAS</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ===== Firebase Configuration ===== */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY_HERE",
  authDomain: "YOUR_AUTHDOMAIN_HERE",
  projectId: "YOUR_PROJECTID_HERE",
  storageBucket: "YOUR_STORAGEBUCKET_HERE",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID_HERE"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ==== Variables & Data ==== */
let username = "";
let questions = [];
let index = 0;
let score = 0;
let selectedCasId = "";

/* ==== CAS Database ==== */
const casData = {
  cas1: {
    title: "CAS 1 ‚Äì M√©decine l√©gale",
    questions: [
      { q: "√ätes-vous oblig√© de vous d√©placer ?", correction: "Oui, r√©quisition l√©gale obligatoire." },
      { q: "√âl√©ments √† rechercher lors de la lev√©e de corps ?", correction: "Examen des lieux, v√™tements, √©tat du corps, pr√©l√®vements." },
      { q: "Signes cadav√©riques observables ?", correction: "Rigidit√©, lividit√©s, cyanose, h√©matomes, abrasions." }
    ]
  },
  cas2: {
    title: "CAS 2 ‚Äì Cardiologie",
    questions: [{ q: "Signes d'insuffisance cardiaque ?", correction: "Dyspn√©e, ≈ìd√®mes, r√¢les cr√©pitants, turgescence jugulaire." }]
  },
  cas3: {
    title: "CAS 3 ‚Äì Pneumologie",
    questions: [{ q: "Signes de d√©tresse respiratoire ?", correction: "Polypn√©e, tirage, cyanose, agitation." }]
  },
  cas4: {
    title: "CAS 4 ‚Äì Endocrinologie",
    questions: [{ q: "Signes cliniques du diab√®te ?", correction: "Polyurie, polydipsie, amaigrissement." }]
  },
  cas5: {
    title: "CAS 5 ‚Äì Gyn√©cologie",
    questions: [{ q: "Signes de grossesse extra-ut√©rine ?", correction: "Douleur pelvienne, am√©norrh√©e, m√©trorragies." }]
  }
};

/* ==== Prompt Username ==== */
function askUsername(){
  username = prompt("Entrez votre nom:");
  if(!username || username.trim() === ""){
    alert("Le nom est requis.");
    askUsername(); // ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∑ŸÑÿ®
  } else {
    document.getElementById("welcomeText").innerText = "Bienvenue, " + username + "!";
    loadStats();
  }
}
askUsername();

/* ==== Functions ==== */
function startCas(casId){
  selectedCasId = casId;
  const selected = casData[casId];
  questions = selected.questions;
  index = 0;
  score = 0;

  document.getElementById("casTitle").innerText = selected.title;
  document.getElementById("score").innerText = score;

  document.getElementById("home").style.display = "none";
  document.getElementById("quiz").style.display = "block";
  loadQuestion();
}

function loadQuestion(){
  document.getElementById("question").innerText = questions[index].q;
  document.getElementById("answer").style.display = "none";
  document.getElementById("userAnswer").value = "";
}

function showAnswer(){
  document.getElementById("answer").innerText = questions[index].correction;
  document.getElementById("answer").style.display = "block";
}

function next(isCorrect){
  if(isCorrect) score++;
  document.getElementById("score").innerText = score;
  index++;

  if(index < questions.length){
    loadQuestion();
  } else {
    alert("Fin du CAS ‚úÖ Score : " + score + "/" + questions.length);

    db.collection("results").add({
      user: username,
      cas: selectedCasId,
      score: score,
      total: questions.length,
      date: new Date().toLocaleString()
    }).then(() => {
      backHome();
    });
  }
}

function backHome(){
  document.getElementById("quiz").style.display = "none";
  document.getElementById("home").style.display = "block";
  loadStats();
}

function loadStats(){
  const statsList = document.getElementById("stats");
  statsList.innerHTML = "";

  db.collection("results").orderBy("date", "desc").get().then(snapshot => {
    snapshot.forEach(doc => {
      const r = doc.data();
      const li = document.createElement("li");

      li.innerText = 
        r.user + " ‚Äì " + casData[r.cas].title +
        " : " + r.score + "/" + r.total +
        " (" + r.date + ")";

      statsList.appendChild(li);
    });

    if(statsList.innerHTML === "") {
      statsList.innerHTML = "<li>Aucune tentative enregistr√©e.</li>";
    }
  });
}

function toggleDark(){
  document.body.classList.toggle("dark");
}
</script>

</body>
</html>